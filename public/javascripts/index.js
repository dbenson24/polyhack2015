// Generated by CoffeeScript 1.7.1
(function() {
  var fillEvents, myLat, myLng, r;

  myLat = 42.4039256;

  myLng = -71.1168384;

  window.changeLocation = function() {
    myLat = $("#lat").val();
    myLng = $("#lng").val();
    $("#events").html("");
    if (window.animation != null) {
      clearInterval(window.animation);
      window.animation = null;
    }
    return $.getJSON("/api/locations/" + myLat + "/" + myLng, function(result) {
      var data;
      data = result.result.locations;
      plotRoute(data);
      fillEvents(data.slice(0, 9));
      return $("#link").html("https://polyhack2015-dbenson24.c9.io/#" + result.result._id);
    });
  };


  /*
  Oh, if you could get the reviews working, that would be awesome
  
  Also, thanks. We've been getting pretty frusturated.
  
  What about the reviews tho
  I don't really get where they are displayed
  or what they do
  
  
  Can you guys write out a nice Readme?
   */

  window.writeText = function(text, selector, rate) {
    var i, write, x, _results;
    i = 0;
    write = function() {
      var header;
      header = $(selector);
      header.html(header.html() + text[i]);
      return i++;
    };
    x = 0;
    _results = [];
    while (x < text.length) {
      setTimeout(write, x * rate);
      _results.push(x++);
    }
    return _results;
  };

  fillEvents = function(locations) {
    var content, events, id, loc, _i, _len, _results;
    console.log("locations", locations);
    events = $("#events");
    _results = [];
    for (id = _i = 0, _len = locations.length; _i < _len; id = ++_i) {
      loc = locations[id];
      content = "<li id=\"msg_" + id + "\" class=\"event\">\n</li>";
      events.html(events.html() + content);
      _results.push(writeText(loc.sentence, "#msg_" + id, 100));
    }
    return _results;
  };

  if (window.location.hash === "#" || window.location.hash === "") {

  } else {
    r = $.getJSON("/api/saved/" + window.location.hash.substring(1), function(result) {
      var data;
      if (result.err != null) {
        alert("That was an invalid Skeleton Story. Redirecting...");
        return setTimeout(function() {
          window.location.hash = "";
          window.location.href = window.location.href;
          return location.reload(true);
        }, 2000);
      } else {
        data = result.result.locations;
        plotRoute(data);
        return fillEvents(data.slice(0, 9));
      }
    });
    r.fail(function() {
      alert("That was an invalid Skeleton Story. Redirecting...");
      return setTimeout(function() {
        window.location.hash = "";
        window.location.href = window.location.href;
        return location.reload(true);
      }, 2000);
    });
  }

  writeText("Skeleton Activity", ".header h1", 250);

}).call(this);
